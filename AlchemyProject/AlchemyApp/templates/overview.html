{% extends "layout.html" %}

{% block body %}

<div id="wizard_container" class="flex min-h-screen items-center justify-center">
        
    <!-- <button id="previous-button" class="fixed left-16 top-1/2 transform -translate-y-1/2 w-36 min-w-36 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl py-2 rounded focus:outline-none focus:shadow-outline disabled:opacity-50 disabled:cursor-not-allowed">←</button> -->

    <div id="initial_box" class="overview_form w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150">
        <div id="initial_headers" class="text-center">
            <h1 class="text-4xl font-black tracking-wide text-blue-600 mb-2">Intake Questionnaire</h1>
            <h1 class="text-xl font-black tracking-wide text-blue-500 mb-8 overflow-x-auto whitespace-nowrap">Let's first get down the basics.</h1>
            <p class="text-lg tracking-wide">This initial questionnaire will help us understand the system you want FedRAMP Authorized and provide it with its very own FedRAMP Impact Level.</p>
            <br>
            <p class="text-lg tracking-wide">Please be as detailed and accurate as possible in your answers - the more information you supply, the better. We'll ask any follow-up questions in real time based on what you provide.</p>
        </div>
    </div>
    
    <div id="org_info_box" class="overview_form w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150">
        
        <div id="org_info_headers" class="text-center">
            <h1 class="text-2xl sm:text-4xl font-black tracking-wide text-blue-600 mb-2">Organization Information</h1>
            <h1 class="text-base sm:text-xl font-black tracking-wide text-blue-500 mb-8">Provide some general information about your organization.</h1>
        </div>

        <form id="org_info_form" action="#" method="post" class="space-y-8">
            {% csrf_token %}
            
            <div>
                <label for="{{org_form.client_name.id_for_label" class="block mb-1 font-semibold text-sm text-blue-700 opacity-70">Organization Name</label>
                <input type="text" name="{{org_form.client_name.name}}" id="{{org_form.client_name.auto_id}}" value="{{organization|default:org_form.client_name.value|default:''}}" placeholder="e.g., Acme Industries" required class="mt-1 w-full p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200 {% if form.client_name.errors %}border-red-500{% endif %}">
                {% if org_form.client_name.errors %}
                    <span class="text-red-500 text-xs mt-1">
                        {{ org_form.client_name.errors.0 }}
                    </span>
                {% endif %}
            </div>
            
            <div>
                <div>
                    <label for="{{org_form.address1.id_for_label}}" class="block mb-1 font-semibold text-sm text-blue-700 opacity-70">Organization Address</label>
                    <input type="text" name="{{org_form.address1.name}}" id="{{org_form.address1.auto_id}}" value="{{ organization.address1|default:org_form.address1.value|default:'' }}" placeholder="Street Address" required class="mt-1 w-full p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200 {% if form.address1.errors %}border-red-500{% endif %}">
                    {% if org_form.address1.errors %}
                        <span class="text-red-500 text-xs mt-1">
                            {{ org_form.address1.errors.0 }}
                        </span>
                    {% endif %}
                </div>
                <div class="flex mt-4">
                    <input type="text" name="{{org_form.address2.name}}" id="{{org_form.address2.auto_id}}" value="{{ organization.address2|default:org_form.address2.value|default:'' }}" placeholder="Unit/Suite Number" class="mr-6 w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200 {% if form.address2.errors %}border-red-500{% endif %}">
                    {% if org_form.address2.errors %}
                        <span class="text-red-500 text-xs mt-1">
                            {{ org_form.address2.errors.0 }}
                        </span>
                    {% endif %}
                    <input type="text" name="{{org_form.city.name}}" id="{{org_form.city.auto_id}}" value="{{ organization.city|default:org_form.city.value|default:'' }}" placeholder="City" required class="w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200 {% if form.city.errors %}border-red-500{% endif %}">
                    {% if org_form.city.errors %}
                        <span class="text-red-500 text-xs mt-1">
                            {{ org_form.city.errors.0 }}
                        </span>
                    {% endif %}
                </div>
                <div class="flex mt-4">
                    <div class="w-1/2 mr-6">
                        <select name="{{org_form.state.name}}" id="{{org_form.state.auto_id}}" class="mt-1 w-full p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200{% if org_form.state.errors %}border-red-500{% endif %}">
                            <option value="">Select a state/territory</option>
                            {% for value, display_name in org_form.state.field.choices %}
                                <option value="{{ value }}" {% if organization.state|default:org_form.state.value == value %}selected{% endif %}>{{ display_name }}</option>
                            {% endfor %}
                        </select>
                        {% if org_form.state.errors %}
                            <span class="text-red-500 text-xs mt-1">
                                {{ org_form.state.errors.0 }}
                            </span>
                        {% endif %}
                    </div>

                    <div class="w-1/2">
                        <input type="text" name="{{org_form.zip_code.name}}" id="{{org_form.zip_code.auto_id}}" value="{{organization.zip_code|default:org_form.zip_code.value|default:''}}" placeholder="Zip Code" required class="mt-1 w-full p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200 {% if form.zip_code.errors %}border-red-500 {% endif %}">
                        {% if org_form.zip_code.errors %}
                            <span class="text-red-500 text-xs mt-1">
                                {{ org_form.zip_code.errors.0 }}
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="flex justify-between space-x-12">
                <!-- Previous Button -->
                <button id="previous-btn" type="button" style="width: 25%" class="bg-blue-600 hover:bg-blue-700 text-white font-bold text-2xl p-2.5 rounded focus:outline-none focus:shadow-outline transition duration-200">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
            
                <!-- Save Button -->
                <button id="org-save-btn" type="submit" class="w-1/2 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl p-2.5 rounded focus:outline-none focus:shadow-outline transition duration-200">
                    Save
                </button>
            
                <!-- Next Button -->
                <button id="next-btn" type="button" style="width: 25%" class="bg-blue-600 hover:bg-blue-700 text-white font-bold text-2xl p-2.5 rounded focus:outline-none focus:shadow-outline transition duration-200">
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
            
        </form>

    </div>

    <div id="system_info_box" class="overview_form w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150">
        
        <div id="system_info_box" class="text-center">
            <h1 class="text-4xl font-black tracking-wide text-blue-600 mb-2 overflow-x-auto whitespace-nowrap">System Information</h1>
            <h1 class="text-base sm:text-xl font-black tracking-wide text-blue-500 mb-8">Next, provide some general information about the system you'd like Authorized.</h1>
        </div>

        <form action="{% url 'alchemy:overview' %}" method="post" class="space-y-8">
            {% csrf_token %}

            <div>
                <label for="system_name" class="block mb-1 font-semibold text-sm text-blue-700 opacity-70 whitespace-nowrap overflow-x-auto">Information System Name</label>
                <input type="text" name="system_name" id="system_name" placeholder="e.g., HR Management System" required class="mt-1 w-full p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200">
            </div>
            
            <div>
                <label for="owner" class="block mb-1 font-semibold text-sm text-blue-700"><span class="opacity-70">Information System Owner</span>
                    <button type="button" class="relative help-icon" aria-label="Help">
                        <i class="fas fa-question-circle text-blue-400 hover:text-blue-600 transition-colors"></i>
                        <div style="width: 30rem;" class="hidden tooltip absolute z-10 left-full ml-8 top-1/2 -translate-y-1/2 bg-white text-sm text-gray-700 py-1 px-2 rounded-md shadow-lg">
                            <span class="py-2 px-4 block">The <span class="font-semibold text-sm text-blue-700 opacity-70">Information System Owner</span> is a senior management role responsible for ensuring a system's security and compliance with FedRAMP requirements. 
                            <br>
                            <br>
                            Common roles that assume the owner designation include <span class="font-semibold text-sm text-blue-700 opacity-70">CIO, CISO, CTO, IT Director, and Manager of Information Security</span>. The owner should have a strong understanding of {{organization}}'s information systems and the authority to make decisions regarding security and risk management. 
                            <br>
                            <br>
                            The designated owner is accountable for the system's overall security and compliance throughout the FedRAMP authorization process.</span>
                        </div>
                    </button>
                </label>

                <div class="flex mt-1">
                    <input type="text" name="owner_name" id="owner_name" placeholder="Name" required class="mr-6 w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200">
                    <input type="text" name="owner_title" id="owner_title" placeholder="Role Title" required class="w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200">
                </div>
                <div class="flex mt-4">
                    <input type="text" name="owner_number" id="owner_number" placeholder="Phone Number" required class="mr-6 w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200">
                    <input type="text" name="owner_email" id="owner_email" placeholder="Email" required class="w-1/2 p-2.5 text-sm border-0 border-b-2 border-gray-200 text-gray-900 focus:ring-0 focus:border-blue-500 hover:border-blue-400 transition duration-200">
                </div>
            </div>

            <div class="w-full">
                <label for="system_description" class="block mb-2 font-semibold text-sm text-blue-700 opacity-70 whitespace-nowrap overflow-x-auto">What is the primary purpose/function of your system? <button class="text-blue-400" id="examplesButton">See example answers</button></label>
                <textarea rows="4" name="system_description" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 hover:border-blue-400 transition duration-200" placeholder="Write your answer here..."></textarea> 
            </div>
        
        </form>

    </div>

    <div id="category_selection_box" class="overview_form my-8 w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150 h-full scrollbar-thin scrollbar-thumb-blue-600 scrollbar-track-gray-200">
            
        <div id="category_selection_headers" class="text-center">
            <h1 class="text-xl sm:text-4xl font-black tracking-wide text-blue-600 mb-2">Information Type Selection</h1>
            <p class="text-base sm:text-xl font-black tracking-wide text-blue-500 mb-8">Please review and select all types of data that flow through your system. Hover over the <i class="text-sm fas fa-question-circle text-blue-400 inline"></i> icons for more information.</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-visible">
            {% csrf_token %}
            {% for information_type in information_types %}
                <div class="category bg-white rounded-lg shadow p-4 relative text-center overflow-visible">
                    
                    <div id="category_item_header" class="mb-4">
                        <span class="text-gray-700 font-semibold">{{information_type.info_category}}</span>

                        <button type="button" class="relative help-icon" aria-label="Help">
                            <i class="fas fa-question-circle text-blue-400 hover:text-blue-600 transition-colors"></i>
                            <div style="width: 15rem;" class="hidden tooltip absolute z-10 left-full ml-8 top-1/2 -translate-y-1/2 bg-white text-sm text-gray-700 py-1 px-2 rounded-md shadow-lg">
                                <span class="py-2 px-4 block">{{information_type.category_description}}</span>
                            </div>
                        </button>
                    </div>
    
                    <div class="items-center">
                        <div>
                            <p class="text-center text-sm text-gray-600 mb-2">Select all that apply:</p>
                        </div>

                        <div class="subcategories flex flex-col grid grid-cols-1 gap-2">
                            {% for subcategory in information_type.informationsubcategory_set.all %}
                            <div class="flex justify-around">
                                <div id="subcategory_title" class="pr-2 subcategory_item text-black bg-gray-100 hover:bg-blue-600 hover:text-white hover:cursor-pointer transition-colors duration-200 p-2 rounded-lg w-4/5 flex justify-between items-center">
                                    <span class="text-sm block opacity-70 whitespace-nowrap overflow-x-auto max-w-full truncate">{{subcategory.info_subcategory}}</span>
                                    <i class="opacity-0 fas fa-check text-white"></i>
                                </div>

                                <button type="button" class="relative help-icon" aria-label="Help">
                                    <i class="fas fa-question-circle text-blue-400 hover:text-blue-600 transition-colors"></i>
                                    <div style="min-width: 15rem;" class="hidden tooltip absolute z-10 left-full ml-8 top-1/2 -translate-y-1/2 bg-white text-sm text-gray-700 py-1 px-2 rounded-md shadow-lg">
                                        <span class="py-2 px-4 block">{{subcategory.subcategory_description}}</span>
                                    </div>                                  
                                </button>                                
                                
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <button id ="scrollButton" class="fixed right-8 bottom-8 bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg">
            <i id="scrollIcon" class="fas fa-chevron-down"></i>
        </button>

    </div>

    <!-- <div id="category_impact_intro_box" class="overview_form w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150"></div>
        <div id="category_impact_intro" class="text-center">
            <h1 class="text-4xl font-black tracking-wide text-blue-600 mb-2">Information Type Impacts</h1>
            <h1 class="text-xl font-black tracking-wide text-blue-500 mb-8 overflow-x-auto whitespace-nowrap">Nice job selecting those information types!</h1>
            <p class="text-lg tracking-wide">We agree with your proposed information types that flow through your system. Now, for each in-scope data type, we'll qualitatively define the security impact levels for loss of confidentiality, integrity and availability.</p>
        </div>
    </div> -->

    <!-- <button id="next-button"class="fixed right-16 top-1/2 transform -translate-y-1/2 w-36 min-w-36 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl py-2 rounded focus:outline-none focus:shadow-outline disabled:opacity-50 disabled:cursor-not-allowed">→</button> -->
    <div id="category_impact_intro_box" class="overview_form w-5/6 min-w-100 md:w-192 bg-white p-10 rounded-lg shadow-lg hidden opacity-0 transition-opacity duration-150">
        <div id="category_impact_intro" class="text-center">
            <h1 class="text-4xl font-black tracking-wide text-blue-600 mb-2">Information Type Impacts</h1>
            <h1 class="text-xl font-black tracking-wide text-blue-500 mb-8">Nice job selecting those information types - just a few more questions to go.</h1>
            <p class="text-lg tracking-wide">We agree with your proposed information types that flow through your system. Now, for each in-scope data type, we'll qualitatively define the security impact levels for loss of confidentiality, integrity and availability. <button class="text-blue-400" id="impact_intro_button">What does this mean?</button></label></p>
        </div>
    </div>

    <!-- Modal for the primary function/purpose view in wizard -->
    <div id="primaryFunctionModal" class="flex items-center justify-center fixed inset-0 hidden bg-gray-900 bg-opacity-50 z-10">

        <div class="relative min-w-768 w-256 bg-white rounded-lg shadow-lg p-8 m-4 mx-12">

            <button class="absolute top-2 right-4 text-gray-900 text-xl font-bold opacity-70 focus:outline-none hover:text-gray-600" id="closeExamplesModal">&times;</button>
            
            <h1 class="text-xl sm:text-2xl font-bold tracking-wide text-blue-600">Example Answers</h1>
            <p class="text-base sm:text-md font-semibold text-blue-500 mb-2">Here are some example answers to help you understand the type of information we are looking for:</p>

            <ul class="list-disc ml-8 mb-4">
                <li class="mb-2"><span class="font-bold text-blue-600">Example 1:</span>"Our information system, Acme Payroll, is designed to manage payroll and benefits for federal employees. It calculates salaries, deductibles, and taxes, and automates the payment process for employees. The system processes financial data, such as salary information, bank account details, and tax information."</li>
                <li class="mb-2"><span class="font-bold text-blue-600">Example 2:</span>"The information system, SecureFile, is a document management and collaboration platform used by federal agencies. It enables users to store, share, and collaborate on documents and files, including classified or sensitive information. The system processes various types of data, including text documents, spreadsheets, images, and multimedia files."</li>
                <li class="mb-2"><span class="font-bold text-blue-600">Example 3:</span>"Our system, HealthBridge, is a telemedicine platform that connects federal employees with healthcare providers for remote consultations and virtual appointments. It allows users to access their electronic health records, schedule appointments, and communicate with healthcare providers through video calls. The system processes personal and health information, including medical records, prescription details, and insurance information."</li>
            </ul>

            <p>Consider the type of data your system handles and the potential impact on {{organization}} or your federal clients if the data is compromised.</p>

        </div>
    </div>

    <!-- Modal for the impact discussion in wizard -->
    <div id="impactDiscussionModal" class="flex items-center justify-center fixed inset-0 hidden bg-gray-900 bg-opacity-50 z-10">

        <div class="relative min-w-768 w-256 bg-white rounded-lg shadow-lg p-8 m-4 mx-12">

            <button class="absolute top-2 right-4 text-gray-900 text-xl font-bold opacity-70 focus:outline-none hover:text-gray-600" id="closeImpactModel">&times;</button>
            
            <h1 class="text-xl sm:text-2xl font-bold tracking-wide text-blue-600">Understanding FedRAMP Impact Levels</h1>
            <p class="text-base sm:text-md font-semibold text-blue-500 mb-2">The confidentiality, integrity, and availability for the federal information types that flow through your system may be impacted differently in a security incident.</p>

            <ul class="list-disc ml-8 mb-4">
                <li class="mb-2"><span class="font-bold text-blue-600">Confidentiality Impact: </span>The potential harm or consequences to an organization or individuals if sensitive information is accessed, disclosed, or intercepted by unauthorized parties.</li>
                <li class="mb-2"><span class="font-bold text-blue-600">Integrity Impact: </span>The potential damage or repercussions resulting from unauthorized changes, alterations, or deletions of data or systems, affecting the accuracy and consistency of the information.</li>
                <li class="mb-2"><span class="font-bold text-blue-600">Availability Impact: </span>The potential negative outcomes arising from a disruption or denial of access to data and services for authorized users, impacting system uptime, reliability, and overall performance.</li>
            </ul>

            <p>Assessing potential consequences of security incidents for confidentiality, integrity, and availability will determine how rigorous the FedRAMP requirements for your system are.</p>

        </div>
    </div>
  
</div>
  
<!-- Javascript for interactive aspects of the onboarding wizard -->
<script type="text/javascript">

    document.addEventListener('DOMContentLoaded', function () {
        changeVisibility(document.querySelector("#initial_box"), false);
        setupSubcategorySelection();
        setupTooltips();
        orgFormBtn();
    });

    // General selections
    const overviewForms = document.querySelectorAll('.overview_form'); //Saving all the overview forms in a variable for later use
    const primaryFunctionModal = document.getElementById("primaryFunctionModal"); //Saving the modal in the primary function view in a variable for later use
    const impactDiscussionModal = document.getElementById("impactDiscussionModal"); //Saving the modal in the impact intro view in a variable for later use
    const categories = document.querySelectorAll('.category'); //Saving the categories in the info categorization view in a variable for later use
    let currentFormIndex = 0; //Initializing the counter before we move through views

    function setupSubcategorySelection() {
        const subcategoryItems = document.querySelectorAll('.subcategory_item');

        subcategoryItems.forEach(function (item) {
            item.addEventListener('click', function () {
                const checkmark = item.querySelector('.fa-check');

                if (item.classList.contains("selected")) {
                    item.classList.remove("selected", "bg-blue-600", "text-white");
                    item.classList.add("bg-gray-100", "text-black");
                    checkmark.classList.add('opacity-0');
                } else {
                    item.classList.remove("bg-gray-100", "text-black");
                    item.classList.add("selected", "bg-blue-600", "text-white");
                    checkmark.classList.remove('opacity-0');
                }
            });
        });
    }

    function setupTooltips() {
        const helpIcons = document.querySelectorAll(".help-icon");

        helpIcons.forEach((icon) => {
            const tooltip = icon.querySelector(".tooltip");

            icon.addEventListener("mouseenter", () => {
                tooltip.classList.remove("hidden");
            });

            icon.addEventListener("mouseleave", () => {
                tooltip.classList.add("hidden");
            });
        });
    }

    function orgFormBtn() {
    
        const saveBtn = document.getElementById("org-save-btn");
        saveBtn.addEventListener("click", function(event) {
            event.preventDefault();
            
            const formData = new FormData(document.querySelector("#org_info_form"));
            const jsonData = Object.fromEntries(formData.entries());

            fetch("{% url 'alchemy:create_update_org' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify(jsonData)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    console.log("Client saved successfully");
                } else {
                    console.log("Error saving organization:", result.errors);
                }
            })
            .catch(error => {
                console.log("Request failed:", error);
            });
        });
    };

    // Function for all views. Allows moving between views using left and right arrow keys. Checks if a modal is present - if one is, a user cannot toggle views until modal is inactive again.
    document.addEventListener("keydown", (event) => {

        const isModalHidden = primaryFunctionModal.classList.contains("hidden")

        // When there is no modal active and the user hits the right arrow key, hide the current overview box, increment the counter, and show the new box using the custom transition function.
        if  (isModalHidden) {
            if (event.key === "ArrowRight" && currentFormIndex < (overviewForms.length - 1)) {
                // Do something. show the next item and hide the current one
                changeVisibility(overviewForms[currentFormIndex], true);
                currentFormIndex++;
                setTimeout(() => {
                    changeVisibility(overviewForms[currentFormIndex], false);
                }, "150");
            
            // Do the same, but for the left arrow key (decrement the counter)
            } else if (event.key === "ArrowLeft" && currentFormIndex != (0)) {
                // Do something. show the next item and hide the current one
                changeVisibility(overviewForms[currentFormIndex], true);
                currentFormIndex--;
                setTimeout(() => {
                    changeVisibility(overviewForms[currentFormIndex], false);
                }, "150");
            }
        }
    });

    // Function for all views. Provides a transition animation in between views by toggling the hidden class attribute and the opacity of the views. Could probably be tweaked better.
    function changeVisibility(element, isVisible) {
        if (isVisible) {
            setTimeout(() => {
                element.classList.add("hidden");
            }, "150");
            element.classList.remove("opacity-100");
            element.classList.add("opacity-0");

        } else {
            element.classList.remove("hidden");
            setTimeout(() => {
                element.classList.remove("opacity-0");
                element.classList.add("opacity-100");
            }, "150");
        }
    }

    // Shows modal on primary purpose view when the "see examples" text is clicked
    document.getElementById("examplesButton").addEventListener("click", function() {
        primaryFunctionModal.classList.remove("hidden");
    });

    // Hides modal on primary purpose view when the close text is clicked
    document.getElementById("closeExamplesModal").addEventListener("click", function() {
        primaryFunctionModal.classList.add("hidden");
    });

    // Also hides modal on primary purpose view when the grayed out background is clicked
    primaryFunctionModal.addEventListener("click", function(event) {
        if (event.target === primaryFunctionModal) {
            primaryFunctionModal.classList.add("hidden");
        }
    });

    // Shows modal on primary purpose view when the "see examples" text is clicked
    document.getElementById("impact_intro_button").addEventListener("click", function() {
        impactDiscussionModal.classList.remove("hidden");
    });

    // Hides modal on primary purpose view when the close text is clicked
    document.getElementById("closeImpactModel").addEventListener("click", function() {
        impactDiscussionModal.classList.add("hidden");
    });

    // Also hides modal on primary purpose view when the grayed out background is clicked
    impactDiscussionModal.addEventListener("click", function(event) {
        if (event.target === impactDiscussionModal) {
            impactDiscussionModal.classList.add("hidden");
        }
    });

    // Scrolling function for category selection view. When the circular scroll button in bottom right is clicked, it will either scroll down or up to show more of the categories
    document.getElementById("scrollButton").addEventListener("click", function() {
        const scrollButton = document.getElementById("scrollButton");
        const scrollIcon = document.getElementById("scrollIcon");

        // If the arrow is pointing down, it targets the new position which is one window-height down, and scrolls to it
        if (scrollIcon.classList.contains("fa-chevron-down")) {
            // Calculate the target scroll position, which is one viewport height from the current scroll position.
            const targetScrollPosition = window.pageYOffset + window.innerHeight;
            
            // Scroll to the target scroll position smoothly.
            window.scrollTo({
                top: targetScrollPosition,
                behavior: "smooth",
            });
        // Otherwise, it scrolls back to the top (implying the arrow is pointing up)
        } else {
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
    })

    // Second scrolling function for category selection view. Responsible for changing the arrow in the icon to up and down depending on where the user is vertically. 
    window.addEventListener("scroll", () => {
        const scrollButton = document.getElementById("scrollButton");
        const scrollIcon = document.getElementById("scrollIcon");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop;

        // When the user is near or at the bottom of the page, switches chevron to up, otherwise it will be pointing down
        if (scrollHeight - clientHeight - scrollTop < 5) {
            scrollIcon.classList.remove("fa-chevron-down");
            scrollIcon.classList.add("fa-chevron-up");
        } else {
            scrollIcon.classList.remove("fa-chevron-up");
            scrollIcon.classList.add("fa-chevron-down");
        }
    });

</script>

{% endblock %}